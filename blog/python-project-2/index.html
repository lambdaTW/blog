<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>Python Project (2) Lint Your Project | Lambda</title><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="Lint your project"><meta name=generator content="Hugo 0.105.0"><meta name=robots content="noindex, nofollow"><link rel=stylesheet href=/ananke/css/main.min.css><meta property="og:title" content="Python Project (2) Lint Your Project"><meta property="og:description" content="Lint your project"><meta property="og:type" content="article"><meta property="og:url" content="/blog/python-project-2/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2021-04-23T00:00:00+00:00"><meta property="article:modified_time" content="2021-04-23T00:00:00+00:00"><meta itemprop=name content="Python Project (2) Lint Your Project"><meta itemprop=description content="Lint your project"><meta itemprop=datePublished content="2021-04-23T00:00:00+00:00"><meta itemprop=dateModified content="2021-04-23T00:00:00+00:00"><meta itemprop=wordCount content="197"><meta itemprop=keywords content="python,project,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Python Project (2) Lint Your Project"><meta name=twitter:description content="Lint your project"></head><body class="ma0 avenir bg-near-white"><header><div class=bg-black><nav class="pv3 ph3 ph4-ns" role=navigation><div class="flex-l justify-between items-center center"><a href=/ class="f3 fw2 hover-white no-underline white-90 dib">Lambda</a><div class="flex-l items-center"><ul class="pl0 mr3"><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/ title="Home page">Home</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/blog/ title="Blog page">Blog</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/categories/ title="Categories page">Categories</a></li></ul><div class=ananke-socials></div></div></div></nav></div></header><main class=pb7 role=main><article class="flex-l flex-wrap justify-between mw8 center ph3"><header class="mt4 w-100"><aside class="instapaper_ignoref b helvetica tracked">BLOG</aside><div id=sharing class="mt3 ananke-socials"></div><h1 class="f1 athelas mt3 mb1">Python Project (2) Lint Your Project</h1><p class=tracked>By <strong><a href=mailto:lambda@lambda.tw>lambda@lambda.tw</a></strong></p><time class="f6 mv4 dib tracked" datetime=2021-04-23T00:00:00Z>April 23, 2021</time></header><div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><h1 id=lint>Lint</h1><p>程式寫出來不難，但是要寫的好看很難很難，在多人協作時就需要一個標準，讓大家可以寫起來差不多，Python 給出了 <a href=https://www.python.org/dev/peps/pep-0008/>PEP (Python Enhancement Proposals) 8 Style Guide for Python Code</a> 當然正常人不會去看完，所以有工具幫忙就很重要了，這邊介紹 <code>falke8</code>, <code>black</code>, <code>isort</code> 等，工具，方便統一 Coding Style</p><h2 id=flake8>Flake8</h2><p><code>Flake8</code> 可以檢查專案是否符合 <code>PEP 8</code> ，然而，該檢查有些過時或是有些規範是相互違反的，這部分就有待團隊自行去規定，此時就需要設定他，<code>Flake8</code> 支援 <code>setup.cfg</code>, <code>tox.ini</code>, 或 <code>.flake8</code> 檔，作為設定，此處為了減少檔案，我們使用上次使用到的 <code>setup.cfg</code> 作為我們的設定檔</p><h3 id=usage>Usage</h3><p>裝好該指令後就可以對你的專案進行檢查</p><pre tabindex=0><code class=language-shell-script data-lang=shell-script>pip3 install flake8
flake8
</code></pre><h3 id=max-line-length>Max Line Length</h3><p><code>PEP 8</code> 最常被調整的設定就是其每一行程式碼不可超過的字數，該設定原本為每一行不可以超過 79 字元，其由來是以前的 Terminal 長度為 80 字元，為了不讓他換行，所以建議使用該設定，但是現在螢幕都很寬，所以我們可以與團隊溝通調整最大長度</p><pre tabindex=0><code># setup.cfg
[flake8]
max-line-length = 88
</code></pre><h3 id=exclude>Exclude</h3><p>某些檔案可能是由機器自動產生的，你不希望被納入控管，可以使用 <code>exclude</code> 的設定讓他跳過該檔案或目錄，這邊以 Django 的 migration file (機器產生)，以及常見虛擬環境目錄 (他人專案) 作為範例</p><pre tabindex=0><code>#setup.cfg
[flake8]
exclude = */migrations/,env/,venv/
</code></pre><h3 id=ignore>Ignore</h3><p>在 <code>PEP 8</code> 中不少警告是對立的，如：<a href=https://www.flake8rules.com/rules/W503.html>W503</a>、<a href=https://www.flake8rules.com/rules/W504.html>W504</a>，他們的 <code>Best practice</code> 剛好是對方的 <code>Anti-pattern</code> 團隊們可以選擇對於團隊而言比較好的選項，此時我們就可以忽略該筆檢查</p><pre tabindex=0><code>#setup.cfg
[flake8]
ignore = W503
</code></pre><h2 id=black>Black</h2><p>除了 <code>PEP 8</code> 如何讓團隊寫起來的程式碼都更加相同呢？<a href=https://github.com/psf/black><code>Black</code></a> 提供了自動格式程式碼的功能，我們可以利用它來檢查以及自動格式化所有程式碼，讓它符合規範，該套件支援的設定檔是：<a href=https://www.python.org/dev/peps/pep-0518/><code>pyproject.toml</code></a></p><h3 id=note>Note</h3><p>另一個差不多功能的套件是 <a href=https://github.com/google/yapf><code>yapf</code></a></p><h3 id=usage-1>Usage</h3><pre tabindex=0><code class=language-shell-script data-lang=shell-script>pip install black
# Check
black --check .
# Format
black .
</code></pre><h3 id=line-length>Line Length</h3><p>和 <code>Flake8</code> 一樣的問題這邊我們也把自動排版的每行長度加大</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span><span style=color:#75715e># pyproject.toml</span>
</span></span><span style=display:flex><span>[<span style=color:#a6e22e>tool</span>.<span style=color:#a6e22e>black</span>]
</span></span><span style=display:flex><span><span style=color:#a6e22e>line-length</span> = <span style=color:#ae81ff>88</span>
</span></span></code></pre></div><h3 id=exclude-1>Exclude</h3><p>一樣我們可以略過不需要排版的資料夾或檔案</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span><span style=color:#75715e># pyproject.toml</span>
</span></span><span style=display:flex><span>[<span style=color:#a6e22e>tool</span>.<span style=color:#a6e22e>black</span>]
</span></span><span style=display:flex><span><span style=color:#a6e22e>exclude</span> = <span style=color:#e6db74>&#39;&#39;&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>/(
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  | migrations
</span></span></span><span style=display:flex><span><span style=color:#e6db74>)/
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&#39;&#39;&#39;</span>
</span></span></code></pre></div><h2 id=isort>isort</h2><p>在 Python 我們常常 import 多個套件但是多人協作可能就不會把相同的 Library 放在附近，會導致程式碼很混亂，這時候 <a href=https://pycqa.github.io/isort/>isort</a> 就可以處理我們的問題，他可以檢查 import 順序，也可以自動幫你排序，該套件也使用 <a href=https://www.python.org/dev/peps/pep-0518/><code>pyproject.toml</code></a></p><h3 id=usage-2>Usage</h3><pre tabindex=0><code class=language-shell-script data-lang=shell-script>pip install isort
# Check
isort -c .
# Format
isort .
</code></pre><h3 id=configuration>Configuration</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span><span style=color:#75715e># pyproject.toml</span>
</span></span><span style=display:flex><span>[<span style=color:#a6e22e>tool</span>.<span style=color:#a6e22e>isort</span>]
</span></span><span style=display:flex><span><span style=color:#a6e22e>multi_line_output</span> = <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>include_trailing_comma</span> = <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>force_grid_wrap</span> = <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>use_parentheses</span> = <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>ensure_newline_before_comments</span> = <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>line_length</span> = <span style=color:#ae81ff>88</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>extend_skip</span> = [
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;migrations&#34;</span>,
</span></span><span style=display:flex><span>]
</span></span></code></pre></div><h2 id=conclusion>Conclusion</h2><p>介紹了新的設定檔，<a href=https://www.python.org/dev/peps/pep-0518/><code>pyproject.toml</code></a> 他是 <code>PEP 518</code> 所定義的，未來套件大部分都會支援這個設定檔案，所以只要有套件支援，就放進去吧，至少專案看起來會比較統一，當然不可避免的，比較古老的套件可能還沒有完全支援，那就選擇無可避免的檔案去放他吧，這邊我們優先權，先寫起來， <code>pyproject.toml > setup.cfg</code></p><ul class=pa0><li class="list di"><a href=/tags/python/ class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">python</a></li><li class="list di"><a href=/tags/project/ class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">project</a></li></ul><div class="mt6 instapaper_ignoref"><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//blog-khfo0axv59.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></div><aside class="w-30-l mt6-l"><div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links"><p class="f5 b mb3">Related</p><ul class="pa0 list"><li class=mb2><a href=/blog/python-project-1/>Python Project (1) setup.py setup.cfg</a></li><li class=mb2><a href=/blog/closure/>Closure</a></li></ul></div></aside></article></main><footer class="bg-black bottom-0 w-100 pa3" role=contentinfo><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=/>&copy; Lambda 2022</a><div><div class=ananke-socials></div></div></div></footer></body></html>