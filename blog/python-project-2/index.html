<!doctype html><html lang=en><head><title>Python Project (2) Lint Your Project :: Lambda</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Lint your project"><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=/blog/python-project-2/><link rel=stylesheet href=/style.css><link rel="shortcut icon" href=/img/theme-colors/orange.png><link rel=apple-touch-icon href=/img/theme-colors/orange.png><meta name=twitter:card content="summary"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="Python Project (2) Lint Your Project"><meta property="og:description" content="Lint your project"><meta property="og:url" content="/blog/python-project-2/"><meta property="og:site_name" content="Lambda"><meta property="og:image" content="img/favicon/%!s().png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><meta property="article:section" content="python"><meta property="article:section" content="project"><meta property="article:published_time" content="2021-04-23 00:00:00 +0000 UTC"></head><body><div class="container headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>Terminal</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;▾</li><li><ul class=menu__dropdown><li><a href=/>Home</a></li><li><a href=/blog/>Blog</a></li><li><a href=/categories/>Categories</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=/>Home</a></li><li><a href=/blog/>Blog</a></li><li><a href=/categories/>Categories</a></li></ul></nav></header><div class=content><article class=post><h1 class=post-title><a href=/blog/python-project-2/>Python Project (2) Lint Your Project</a></h1><div class=post-meta><time class=post-date>2021-04-23 ::</time>
<span class=post-author>lambda@lambda.tw</span></div><span class=post-tags>#<a href=/tags/python/>python</a>&nbsp;
#<a href=/tags/project/>project</a>&nbsp;</span><div class=post-content><div><h1 id=lint>Lint<a href=#lint class=hanchor arialabel=Anchor>&#8983;</a></h1><p>程式寫出來不難，但是要寫的好看很難很難，在多人協作時就需要一個標準，讓大家可以寫起來差不多，Python 給出了 <a href=https://www.python.org/dev/peps/pep-0008/>PEP (Python Enhancement Proposals) 8 Style Guide for Python Code</a> 當然正常人不會去看完，所以有工具幫忙就很重要了，這邊介紹 <code>falke8</code>, <code>black</code>, <code>isort</code> 等，工具，方便統一 Coding Style</p><h2 id=flake8>Flake8<a href=#flake8 class=hanchor arialabel=Anchor>&#8983;</a></h2><p><code>Flake8</code> 可以檢查專案是否符合 <code>PEP 8</code> ，然而，該檢查有些過時或是有些規範是相互違反的，這部分就有待團隊自行去規定，此時就需要設定他，<code>Flake8</code> 支援 <code>setup.cfg</code>, <code>tox.ini</code>, 或 <code>.flake8</code> 檔，作為設定，此處為了減少檔案，我們使用上次使用到的 <code>setup.cfg</code> 作為我們的設定檔</p><h3 id=usage>Usage<a href=#usage class=hanchor arialabel=Anchor>&#8983;</a></h3><p>裝好該指令後就可以對你的專案進行檢查</p><pre tabindex=0><code class=language-shell-script data-lang=shell-script>pip3 install flake8
flake8
</code></pre><h3 id=max-line-length>Max Line Length<a href=#max-line-length class=hanchor arialabel=Anchor>&#8983;</a></h3><p><code>PEP 8</code> 最常被調整的設定就是其每一行程式碼不可超過的字數，該設定原本為每一行不可以超過 79 字元，其由來是以前的 Terminal 長度為 80 字元，為了不讓他換行，所以建議使用該設定，但是現在螢幕都很寬，所以我們可以與團隊溝通調整最大長度</p><pre tabindex=0><code># setup.cfg
[flake8]
max-line-length = 88
</code></pre><h3 id=exclude>Exclude<a href=#exclude class=hanchor arialabel=Anchor>&#8983;</a></h3><p>某些檔案可能是由機器自動產生的，你不希望被納入控管，可以使用 <code>exclude</code> 的設定讓他跳過該檔案或目錄，這邊以 Django 的 migration file (機器產生)，以及常見虛擬環境目錄 (他人專案) 作為範例</p><pre tabindex=0><code>#setup.cfg
[flake8]
exclude = */migrations/,env/,venv/
</code></pre><h3 id=ignore>Ignore<a href=#ignore class=hanchor arialabel=Anchor>&#8983;</a></h3><p>在 <code>PEP 8</code> 中不少警告是對立的，如：<a href=https://www.flake8rules.com/rules/W503.html>W503</a>、<a href=https://www.flake8rules.com/rules/W504.html>W504</a>，他們的 <code>Best practice</code> 剛好是對方的 <code>Anti-pattern</code> 團隊們可以選擇對於團隊而言比較好的選項，此時我們就可以忽略該筆檢查</p><pre tabindex=0><code>#setup.cfg
[flake8]
ignore = W503
</code></pre><h2 id=black>Black<a href=#black class=hanchor arialabel=Anchor>&#8983;</a></h2><p>除了 <code>PEP 8</code> 如何讓團隊寫起來的程式碼都更加相同呢？<a href=https://github.com/psf/black><code>Black</code></a> 提供了自動格式程式碼的功能，我們可以利用它來檢查以及自動格式化所有程式碼，讓它符合規範，該套件支援的設定檔是：<a href=https://www.python.org/dev/peps/pep-0518/><code>pyproject.toml</code></a></p><h3 id=note>Note<a href=#note class=hanchor arialabel=Anchor>&#8983;</a></h3><p>另一個差不多功能的套件是 <a href=https://github.com/google/yapf><code>yapf</code></a></p><h3 id=usage-1>Usage<a href=#usage-1 class=hanchor arialabel=Anchor>&#8983;</a></h3><pre tabindex=0><code class=language-shell-script data-lang=shell-script>pip install black
# Check
black --check .
# Format
black .
</code></pre><h3 id=line-length>Line Length<a href=#line-length class=hanchor arialabel=Anchor>&#8983;</a></h3><p>和 <code>Flake8</code> 一樣的問題這邊我們也把自動排版的每行長度加大</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span><span style=color:#75715e># pyproject.toml</span>
</span></span><span style=display:flex><span>[<span style=color:#a6e22e>tool</span>.<span style=color:#a6e22e>black</span>]
</span></span><span style=display:flex><span><span style=color:#a6e22e>line-length</span> = <span style=color:#ae81ff>88</span>
</span></span></code></pre></div><h3 id=exclude-1>Exclude<a href=#exclude-1 class=hanchor arialabel=Anchor>&#8983;</a></h3><p>一樣我們可以略過不需要排版的資料夾或檔案</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span><span style=color:#75715e># pyproject.toml</span>
</span></span><span style=display:flex><span>[<span style=color:#a6e22e>tool</span>.<span style=color:#a6e22e>black</span>]
</span></span><span style=display:flex><span><span style=color:#a6e22e>exclude</span> = <span style=color:#e6db74>&#39;&#39;&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>/(
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  | migrations
</span></span></span><span style=display:flex><span><span style=color:#e6db74>)/
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&#39;&#39;&#39;</span>
</span></span></code></pre></div><h2 id=isort>isort<a href=#isort class=hanchor arialabel=Anchor>&#8983;</a></h2><p>在 Python 我們常常 import 多個套件但是多人協作可能就不會把相同的 Library 放在附近，會導致程式碼很混亂，這時候 <a href=https://pycqa.github.io/isort/>isort</a> 就可以處理我們的問題，他可以檢查 import 順序，也可以自動幫你排序，該套件也使用 <a href=https://www.python.org/dev/peps/pep-0518/><code>pyproject.toml</code></a></p><h3 id=usage-2>Usage<a href=#usage-2 class=hanchor arialabel=Anchor>&#8983;</a></h3><pre tabindex=0><code class=language-shell-script data-lang=shell-script>pip install isort
# Check
isort -c .
# Format
isort .
</code></pre><h3 id=configuration>Configuration<a href=#configuration class=hanchor arialabel=Anchor>&#8983;</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span><span style=color:#75715e># pyproject.toml</span>
</span></span><span style=display:flex><span>[<span style=color:#a6e22e>tool</span>.<span style=color:#a6e22e>isort</span>]
</span></span><span style=display:flex><span><span style=color:#a6e22e>multi_line_output</span> = <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>include_trailing_comma</span> = <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>force_grid_wrap</span> = <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>use_parentheses</span> = <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>ensure_newline_before_comments</span> = <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>line_length</span> = <span style=color:#ae81ff>88</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>extend_skip</span> = [
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;migrations&#34;</span>,
</span></span><span style=display:flex><span>]
</span></span></code></pre></div><h2 id=conclusion>Conclusion<a href=#conclusion class=hanchor arialabel=Anchor>&#8983;</a></h2><p>介紹了新的設定檔，<a href=https://www.python.org/dev/peps/pep-0518/><code>pyproject.toml</code></a> 他是 <code>PEP 518</code> 所定義的，未來套件大部分都會支援這個設定檔案，所以只要有套件支援，就放進去吧，至少專案看起來會比較統一，當然不可避免的，比較古老的套件可能還沒有完全支援，那就選擇無可避免的檔案去放他吧，這邊我們優先權，先寫起來， <code>pyproject.toml > setup.cfg</code></p></div></div></article></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2022 Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script type=text/javascript src=/bundle.min.js></script></div></body></html>