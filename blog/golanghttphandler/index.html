<!doctype html><html><head><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"\/"},"articleSection":"blog","name":"GolangHTTPHandler","headline":"GolangHTTPHandler","description":"簡易復刻出的 Golang HTTP HandleFunc 身為一個 web 狗，用新語言寫個 router 也是應該的，Golang 本身在寫 HTTP 服務就有極大的優勢，官方自帶的 library 就很好用了，以至於到目前為止的統計大部分的人還是直接使用原生的 library 而非使用框架，但是 router 這部份就統計看來已經有了大方向， Mux 是目前大多數人使用的 router 框架，這邊我們玩一下 Golang 原生的 handler 讓它可以和原生的 HandleFunc 有一樣的感覺\n第一步：寫一個簡單的 HTTP server 相信大家都不會。。。當然就是要 google\n關鍵字 ： golang http\n第一篇就會看到官方的 library 的連結囉！\n開一個新專案 cd $GOPATH\/src\/ mkdir router touch main.go 依照官方網站的提示寫出一個簡單的 HTTP 服務 package main import ( \x26#34;fmt\x26#34; \x26#34;net\/http\x26#34; \x26#34;html\x26#34; \x26#34;log\x26#34; ) func main() { http.HandleFunc(\x26#34;\/bar\x26#34;, func(w http.ResponseWriter, r *http.Request) { fmt.Fprintf(w, \x26#34;Hello, %q\x26#34;, html.","inLanguage":"en","author":"","creator":"","publisher":"","accountablePerson":"","copyrightHolder":"","copyrightYear":"2018","datePublished":"2018-07-21 00:00:00 \x2b0000 UTC","dateModified":"2018-07-21 00:00:00 \x2b0000 UTC","url":"\/blog\/golanghttphandler\/","wordCount":"433","keywords":["Golang","HTTP","Blog"]}</script><title>GolangHTTPHandler</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.68.3"><meta name=author content="lambda@lambda.tw"><meta name=description content="This blog is about Python, Golang, Django, IT etc."><meta name=twitter:card content="summary"><meta name=twitter:title content="GolangHTTPHandler"><meta name=twitter:description content="簡易復刻出的 Golang HTTP HandleFunc 身為一個 web 狗，用新語言寫個 router 也是應該的，Golang 本身在寫 HTTP 服務就有極大的優勢，官方自帶的 library 就很好用了，以至於到目前為止的統計大部分的人還是直接使用原生的 library 而非使用框架，但是 router 這部份就統計看來已經有了大方向， Mux 是目前大多數人使用的 router 框架，這邊我們玩一下 Golang 原生的 handler 讓它可以和原生的 HandleFunc 有一樣的感覺
第一步：寫一個簡單的 HTTP server 相信大家都不會。。。當然就是要 google
關鍵字 ： golang http
第一篇就會看到官方的 library 的連結囉！
開一個新專案 cd $GOPATH/src/ mkdir router touch main.go 依照官方網站的提示寫出一個簡單的 HTTP 服務 package main import ( &#34;fmt&#34; &#34;net/http&#34; &#34;html&#34; &#34;log&#34; ) func main() { http.HandleFunc(&#34;/bar&#34;, func(w http.ResponseWriter, r *http.Request) { fmt.Fprintf(w, &#34;Hello, %q&#34;, html."><meta property="og:title" content="GolangHTTPHandler"><meta property="og:description" content="簡易復刻出的 Golang HTTP HandleFunc 身為一個 web 狗，用新語言寫個 router 也是應該的，Golang 本身在寫 HTTP 服務就有極大的優勢，官方自帶的 library 就很好用了，以至於到目前為止的統計大部分的人還是直接使用原生的 library 而非使用框架，但是 router 這部份就統計看來已經有了大方向， Mux 是目前大多數人使用的 router 框架，這邊我們玩一下 Golang 原生的 handler 讓它可以和原生的 HandleFunc 有一樣的感覺
第一步：寫一個簡單的 HTTP server 相信大家都不會。。。當然就是要 google
關鍵字 ： golang http
第一篇就會看到官方的 library 的連結囉！
開一個新專案 cd $GOPATH/src/ mkdir router touch main.go 依照官方網站的提示寫出一個簡單的 HTTP 服務 package main import ( &#34;fmt&#34; &#34;net/http&#34; &#34;html&#34; &#34;log&#34; ) func main() { http.HandleFunc(&#34;/bar&#34;, func(w http.ResponseWriter, r *http.Request) { fmt.Fprintf(w, &#34;Hello, %q&#34;, html."><meta property="og:type" content="article"><meta property="og:url" content="/blog/golanghttphandler/"><meta property="article:published_time" content="2018-07-21T00:00:00+00:00"><meta property="article:modified_time" content="2018-07-21T00:00:00+00:00"><meta property="og:image" content="//images/logo.png"><meta property="og:image:type" content="image/png"><meta property="og:image:width" content="512"><meta property="og:image:height" content="512"><meta itemprop=name content="GolangHTTPHandler"><meta itemprop=description content="簡易復刻出的 Golang HTTP HandleFunc 身為一個 web 狗，用新語言寫個 router 也是應該的，Golang 本身在寫 HTTP 服務就有極大的優勢，官方自帶的 library 就很好用了，以至於到目前為止的統計大部分的人還是直接使用原生的 library 而非使用框架，但是 router 這部份就統計看來已經有了大方向， Mux 是目前大多數人使用的 router 框架，這邊我們玩一下 Golang 原生的 handler 讓它可以和原生的 HandleFunc 有一樣的感覺
第一步：寫一個簡單的 HTTP server 相信大家都不會。。。當然就是要 google
關鍵字 ： golang http
第一篇就會看到官方的 library 的連結囉！
開一個新專案 cd $GOPATH/src/ mkdir router touch main.go 依照官方網站的提示寫出一個簡單的 HTTP 服務 package main import ( &#34;fmt&#34; &#34;net/http&#34; &#34;html&#34; &#34;log&#34; ) func main() { http.HandleFunc(&#34;/bar&#34;, func(w http.ResponseWriter, r *http.Request) { fmt.Fprintf(w, &#34;Hello, %q&#34;, html."><meta itemprop=datePublished content="2018-07-21T00:00:00+00:00"><meta itemprop=dateModified content="2018-07-21T00:00:00+00:00"><meta itemprop=wordCount content="433"><meta itemprop=keywords content="Golang,HTTP,"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Raleway:400,800,900|Source+Sans+Pro:400,700"><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.1.25/jquery.fancybox.min.css><link rel=stylesheet href=/css/main.css><link rel=stylesheet href=/css/add-on.css><link rel=stylesheet href=/css/academicons.min.css><link href=//cdn.bootcss.com/highlight.js/9.11.0/styles/github.min.css rel=stylesheet type=text/css></head><body><div id=wrapper><header id=header><h1><a href=/>blog</a></h1><nav class=links><ul><li><a href=/><i class="fa fa-home">&nbsp;</i>Home</a></li><li><a href=/blog/><i class="fa fa-newspaper-o">&nbsp;</i>Blog</a></li><li><a href=/categories/><i class="fa fa-sitemap">&nbsp;</i>Categories</a></li></ul></nav><nav class=main><ul><li id=share-nav class=share-menu style=display:none><a class=fa-share-alt href=#share-menu>Share</a></li><li class=search><a class=fa-search href=#search>Search</a><form id=search method=get action=//google.com/search><input type=text name=q placeholder=Search>
<input type=hidden name=as_sitesearch value=/></form></li><li class=menu><a class=fa-bars href=#menu>Menu</a></li></ul></nav></header><section id=menu><section><form class=search method=get action=//google.com/search><input type=text name=q placeholder=Search>
<input type=hidden name=as_sitesearch value=/></form></section><section><ul class=links><li><a href=/><h3><i class="fa fa-home">&nbsp;</i>Home</h3></a></li><li><a href=/blog/><h3><i class="fa fa-newspaper-o">&nbsp;</i>Blog</h3></a></li><li><a href=/categories/><h3><i class="fa fa-sitemap">&nbsp;</i>Categories</h3></a></li></ul></section><section class=recent-posts><div class=mini-posts><header><h3>Recent Posts</h3></header><article class=mini-post><header><h3><a href=/blog/python-project-5/>Python Project (5) Make Automatically</a></h3><time class=published datetime=2021-04-27>April 27, 2021</time></header></article><article class=mini-post><header><h3><a href=/blog/python-project-4/>Python Project (4) Test More</a></h3><time class=published datetime=2021-04-25>April 25, 2021</time></header></article><article class=mini-post><header><h3><a href=/blog/python-project-3/>Python Project (3) Test Your Project</a></h3><time class=published datetime=2021-04-24>April 24, 2021</time></header></article><article class=mini-post><header><h3><a href=/blog/python-project-2/>Python Project (2) Lint Your Project</a></h3><time class=published datetime=2021-04-23>April 23, 2021</time></header></article><article class=mini-post><header><h3><a href=/blog/python-project-1/>Python Project (1) setup.py setup.cfg</a></h3><time class=published datetime=2021-04-22>April 22, 2021</time></header></article><a href=/blog/ class=button>View more posts</a></div></section></section><section id=share-menu><section id=social-share-nav><ul class=links><header><h3>Share this post <i class="fa fa-smile-o"></i></h3></header><li><a href="//twitter.com/share?url=%2fblog%2fgolanghttphandler%2f&text=GolangHTTPHandler&via=" target=_blank class="share-btn twitter"><i class="fa fa-twitter"></i><p>Twitter</p></a></li><li><a href="//plus.google.com/share?url=%2fblog%2fgolanghttphandler%2f" target=_blank class="share-btn google-plus"><i class="fa fa-google-plus"></i><p>Google+</p></a></li><li><a href="//www.facebook.com/sharer/sharer.php?u=%2fblog%2fgolanghttphandler%2f" target=_blank class="share-btn facebook"><i class="fa fa-facebook"></i><p>Facebook</p></a></li><li><a href="//reddit.com/submit?url=%2fblog%2fgolanghttphandler%2f&title=GolangHTTPHandler" target=_blank class="share-btn reddit"><i class="fa fa-reddit-alien"></i><p>Reddit</p></a></li><li><a href="//www.linkedin.com/shareArticle?url=%2fblog%2fgolanghttphandler%2f&title=GolangHTTPHandler" target=_blank class="share-btn linkedin"><i class="fa fa-linkedin"></i><p>LinkedIn</p></a></li><li><a href="//www.stumbleupon.com/submit?url=%2fblog%2fgolanghttphandler%2f&title=GolangHTTPHandler" target=_blank class="share-btn stumbleupon"><i class="fa fa-stumbleupon"></i><p>StumbleUpon</p></a></li><li><a href="//www.pinterest.com/pin/create/button/?url=%2fblog%2fgolanghttphandler%2f&description=GolangHTTPHandler" target=_blank class="share-btn pinterest"><i class="fa fa-pinterest-p"></i><p>Pinterest</p></a></li><li><a href="mailto:?subject=Check out this post by lambda%40lambda.tw&body=%2fblog%2fgolanghttphandler%2f" target=_blank class="share-btn email"><i class="fa fa-envelope"></i><p>Email</p></a></li></ul></section></section><div id=main><article class=post><header><div class=title><h1><a href=/blog/golanghttphandler/>GolangHTTPHandler</a></h1></div><div class=meta><time class=published datetime=2018-07-21>July 21, 2018</time>
<span class=author>lambda@lambda.tw</span><p>3 minute read</p></div></header><section id=social-share><ul class=icons><li><a href="//twitter.com/share?url=%2fblog%2fgolanghttphandler%2f&text=GolangHTTPHandler&via=" target=_blank class="share-btn twitter"><i class="fa fa-twitter"></i><p>Twitter</p></a></li><li><a href="//plus.google.com/share?url=%2fblog%2fgolanghttphandler%2f" target=_blank class="share-btn google-plus"><i class="fa fa-google-plus"></i><p>Google+</p></a></li><li><a href="//www.facebook.com/sharer/sharer.php?u=%2fblog%2fgolanghttphandler%2f" target=_blank class="share-btn facebook"><i class="fa fa-facebook"></i><p>Facebook</p></a></li><li><a href="//reddit.com/submit?url=%2fblog%2fgolanghttphandler%2f&title=GolangHTTPHandler" target=_blank class="share-btn reddit"><i class="fa fa-reddit-alien"></i><p>Reddit</p></a></li><li><a href="//www.linkedin.com/shareArticle?url=%2fblog%2fgolanghttphandler%2f&title=GolangHTTPHandler" target=_blank class="share-btn linkedin"><i class="fa fa-linkedin"></i><p>LinkedIn</p></a></li><li><a href="//www.stumbleupon.com/submit?url=%2fblog%2fgolanghttphandler%2f&title=GolangHTTPHandler" target=_blank class="share-btn stumbleupon"><i class="fa fa-stumbleupon"></i><p>StumbleUpon</p></a></li><li><a href="//www.pinterest.com/pin/create/button/?url=%2fblog%2fgolanghttphandler%2f&description=GolangHTTPHandler" target=_blank class="share-btn pinterest"><i class="fa fa-pinterest-p"></i><p>Pinterest</p></a></li><li><a href="mailto:?subject=Check out this post by lambda%40lambda.tw&body=%2fblog%2fgolanghttphandler%2f" target=_blank class="share-btn email"><i class="fa fa-envelope"></i><p>Email</p></a></li></ul></section><div id=content><h1 id=簡易復刻出的-golang-http-handlefunc>簡易復刻出的 Golang HTTP HandleFunc</h1><p>身為一個 web 狗，用新語言寫個 router 也是應該的，Golang 本身在寫 HTTP 服務就有極大的優勢，官方自帶的 library 就很好用了，以至於到目前為止的統計大部分的人還是直接使用原生的 library 而非使用框架，但是 router 這部份就統計看來已經有了大方向， <a href=https://github.com/gorilla/mux>Mux</a> 是目前大多數人使用的 router 框架，這邊我們玩一下 Golang 原生的 handler 讓它可以和原生的 HandleFunc 有一樣的感覺</p><h2 id=第一步寫一個簡單的-http-server>第一步：寫一個簡單的 HTTP server</h2><p>相信大家都不會。。。當然就是要 google</p><p>關鍵字 ： golang http</p><p>第一篇就會看到官方的 library 的<a href=https://golang.org/pkg/net/http/>連結</a>囉！</p><h3 id=開一個新專案>開一個新專案</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>cd $GOPATH/src/
mkdir router
touch main.go
</code></pre></div><h3 id=依照官方網站的提示寫出一個簡單的-http-服務>依照官方網站的提示寫出一個簡單的 HTTP 服務</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>

<span style=color:#f92672>import</span> (
	<span style=color:#e6db74>&#34;fmt&#34;</span>
	<span style=color:#e6db74>&#34;net/http&#34;</span>
	<span style=color:#e6db74>&#34;html&#34;</span>
	<span style=color:#e6db74>&#34;log&#34;</span>
)

<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
	<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>HandleFunc</span>(<span style=color:#e6db74>&#34;/bar&#34;</span>, <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>w</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ResponseWriter</span>, <span style=color:#a6e22e>r</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>) {
		<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Fprintf</span>(<span style=color:#a6e22e>w</span>, <span style=color:#e6db74>&#34;Hello, %q&#34;</span>, <span style=color:#a6e22e>html</span>.<span style=color:#a6e22e>EscapeString</span>(<span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>URL</span>.<span style=color:#a6e22e>Path</span>))
	})

	<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Fatal</span>(<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ListenAndServe</span>(<span style=color:#e6db74>&#34;:8080&#34;</span>, <span style=color:#66d9ef>nil</span>))
}
</code></pre></div><h3 id=瀏覽看看>瀏覽看看</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>go run main.go
firefox 127.0.0.1:8080/bar
</code></pre></div><h2 id=所以>所以</h2><p>我們可以知道 Golang 本身其實就可以做簡單的 router 讓對應的 URL 可以去執行你的 function，但是如果你想自己搞呢？</p><h2 id=資料>資料</h2><p>Router 最重要的資訊其實就是 Domain 後面的 URI 或稱作 Path，所以我就用這兩個關鍵字直接打在 接收 <code>*http.Request</code> 的 function 裡面，發現 Path 沒有反應，但是 URI 讓 VScode 給了提示，那另一個 Path 就如同官方的教學，可以用 <code>r.URL.Path</code> 取得。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
	<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>HandleFunc</span>(<span style=color:#e6db74>&#34;/bar&#34;</span>, <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>w</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ResponseWriter</span>, <span style=color:#a6e22e>r</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>) {
        <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>RequestURI</span>
	})
</code></pre></div><h2 id=handler>Handler</h2><p>官方的程式碼中有一段我沒有貼上來，原因就是貼上去會壞掉，那我們要怎麼自己來寫這所謂的 handler 呢？</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#a6e22e>fooHandler</span> <span style=color:#f92672>:=</span> <span style=color:#e6db74>&#34;&#34;</span> <span style=color:#75715e>// 至少要宣告吧
</span><span style=color:#75715e></span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Handle</span>(<span style=color:#e6db74>&#34;/foo&#34;</span>, <span style=color:#a6e22e>fooHandler</span>)
</code></pre></div><p>看看錯誤碼吧</p><pre><code>cannot use foohandler (type string) as type http.Handler in argument to http.Handle:
	string does not implement http.Handler (missing ServeHTTP method)

</code></pre><p>看起來是少了 ServeHTTP 這個方法，所以我們需要讓 fooHandler 有這個 Method 才能跑，但是我們也不知道他要有啥才好，所以回到官方看看找到 <a href=https://golang.org/pkg/net/http/#HandlerFunc.ServeHTTP>ServeHTTP</a>，我們就照著做一個空的 Method 試試看能不能跑。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>myhandler</span> <span style=color:#66d9ef>struct</span> {
}

<span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>handle</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>myhandler</span>) <span style=color:#a6e22e>ServeHTTP</span>(<span style=color:#a6e22e>w</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ResponseWriter</span>, <span style=color:#a6e22e>r</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>){

}
</code></pre></div><p>跑一下</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>go run main.go
firefox 127.0.0.1:8080/foo
</code></pre></div><p>可以看到是空的，但是不會壞掉，那就試著在這個 function 裡面加點東西吧</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Fprint</span>(<span style=color:#a6e22e>w</span>, <span style=color:#e6db74>&#34;r: &#34;</span><span style=color:#f92672>+</span><span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>Method</span><span style=color:#f92672>+</span><span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>URL</span>.<span style=color:#a6e22e>Path</span>)
</code></pre></div><p>重跑一次看看</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>go run main.go
firefox 127.0.0.1:8080/foo
</code></pre></div><p>可以看到 firefox 裡面有文字了</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>r: GET/foo
</code></pre></div><h2 id=來個對應表吧>來個對應表吧</h2><h3 id=對應表>對應表</h3><p>為了要簡易的復刻 HandleFunc 我們就用個簡單的 map 來儲存對應的 URL Path 到對應的 function</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>myhandler</span> <span style=color:#66d9ef>struct</span> {
	<span style=color:#a6e22e>route</span> <span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ResponseWriter</span>, <span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>)
}
</code></pre></div><p>以上我們定義了一個 struct 來當作我們的 handler 讓它有一個 route 的屬性，之後我們就可以讓使用者透過它來讓進來的 Request 跑去我們要的 function 裡面</p><h3 id=註冊>註冊</h3><p>有了表，我們要讓別人可以填表，所以我們在 <code>myhandler</code> 下面實做一個註冊用的 function</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>handle</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>myhandler</span>) <span style=color:#a6e22e>Register</span>(<span style=color:#a6e22e>uri</span> <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>f</span> <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ResponseWriter</span>, <span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>)) {
    <span style=color:#75715e>// 如果還沒初始化，幫它初始化
</span><span style=color:#75715e></span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>handle</span>.<span style=color:#a6e22e>route</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>nil</span> {
		<span style=color:#a6e22e>handle</span>.<span style=color:#a6e22e>route</span> = make(<span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ResponseWriter</span>, <span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>))

	}
	<span style=color:#a6e22e>handle</span>.<span style=color:#a6e22e>route</span>[<span style=color:#a6e22e>uri</span>] = <span style=color:#a6e22e>f</span>
}
</code></pre></div><h3 id=servehttp>ServeHTTP</h3><p>最後就是要處理進來的 Request 啦！我們只要確定近來的 URL Path 有在我們的表內，我們就可以去呼叫存在 route 內所對應的 function</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>handle</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>myhandler</span>) <span style=color:#a6e22e>ServeHTTP</span>(<span style=color:#a6e22e>w</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ResponseWriter</span>, <span style=color:#a6e22e>r</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>) {
	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;r: &#34;</span>, <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>Method</span>, <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>RequestURI</span>) <span style=color:#75715e>// 在 terminal 可以看到 log
</span><span style=color:#75715e></span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>ok</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>handle</span>.<span style=color:#a6e22e>route</span>[<span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>RequestURI</span>]; <span style=color:#a6e22e>ok</span> {
		<span style=color:#a6e22e>handle</span>.<span style=color:#a6e22e>route</span>[<span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>RequestURI</span>](<span style=color:#a6e22e>w</span>, <span style=color:#a6e22e>r</span>)
	}
}
</code></pre></div><h3 id=main>main</h3><p>最後就來玩玩我們寫好的 handler 吧！</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
	<span style=color:#a6e22e>handler</span> <span style=color:#f92672>:=</span> new(<span style=color:#a6e22e>myhandler</span>)
	<span style=color:#a6e22e>handler</span>.<span style=color:#a6e22e>Register</span>(<span style=color:#e6db74>&#34;/ping&#34;</span>, <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>w</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ResponseWriter</span>, <span style=color:#a6e22e>r</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>) {
		<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Fprint</span>(<span style=color:#a6e22e>w</span>, <span style=color:#e6db74>&#34;pong&#34;</span>)
	})
	<span style=color:#a6e22e>s</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Server</span>{
		<span style=color:#a6e22e>Addr</span>:    <span style=color:#e6db74>&#34;:8080&#34;</span>,
		<span style=color:#a6e22e>Handler</span>: <span style=color:#a6e22e>handler</span>,
	}
	<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Fatal</span>(<span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>ListenAndServe</span>())
}
</code></pre></div><h3 id=try-it>Try it!</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>go run main.go
firefox 127.0.0.1:8080/ping
</code></pre></div><h2 id=結論>結論</h2><p>程式就是這樣有了資料就可以很多事情，但是一切一定都不是我們想像的那麼簡單，看看 Mux 上的功能，想想看我們要怎麼做才能完成這麼多功能呢？</p><p>如果要實做出 Middle ware 讓別人可以加，你覺得怎麼改比較好呢？</p><h2 id=最後得程式碼>最後得程式碼</h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>

<span style=color:#f92672>import</span> (
	<span style=color:#e6db74>&#34;fmt&#34;</span>
	<span style=color:#e6db74>&#34;log&#34;</span>
	<span style=color:#e6db74>&#34;net/http&#34;</span>
)

<span style=color:#66d9ef>type</span> <span style=color:#a6e22e>myhandler</span> <span style=color:#66d9ef>struct</span> {
	<span style=color:#a6e22e>route</span> <span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ResponseWriter</span>, <span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>)
}

<span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>handle</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>myhandler</span>) <span style=color:#a6e22e>ServeHTTP</span>(<span style=color:#a6e22e>w</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ResponseWriter</span>, <span style=color:#a6e22e>r</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>) {
	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;r: &#34;</span>, <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>Method</span>, <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>RequestURI</span>)
	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>ok</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>handle</span>.<span style=color:#a6e22e>route</span>[<span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>RequestURI</span>]; <span style=color:#a6e22e>ok</span> {
		<span style=color:#a6e22e>handle</span>.<span style=color:#a6e22e>route</span>[<span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>RequestURI</span>](<span style=color:#a6e22e>w</span>, <span style=color:#a6e22e>r</span>)
	}
}

<span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>handle</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>myhandler</span>) <span style=color:#a6e22e>Register</span>(<span style=color:#a6e22e>uri</span> <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>f</span> <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ResponseWriter</span>, <span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>)) {
	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>handle</span>.<span style=color:#a6e22e>route</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>nil</span> {
		<span style=color:#a6e22e>handle</span>.<span style=color:#a6e22e>route</span> = make(<span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ResponseWriter</span>, <span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>))

	}
	<span style=color:#a6e22e>handle</span>.<span style=color:#a6e22e>route</span>[<span style=color:#a6e22e>uri</span>] = <span style=color:#a6e22e>f</span>
}

<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
	<span style=color:#a6e22e>handler</span> <span style=color:#f92672>:=</span> new(<span style=color:#a6e22e>myhandler</span>)
	<span style=color:#a6e22e>handler</span>.<span style=color:#a6e22e>Register</span>(<span style=color:#e6db74>&#34;/ping&#34;</span>, <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>w</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ResponseWriter</span>, <span style=color:#a6e22e>r</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>) {
		<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Fprint</span>(<span style=color:#a6e22e>w</span>, <span style=color:#e6db74>&#34;pong&#34;</span>)
	})
	<span style=color:#a6e22e>s</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Server</span>{
		<span style=color:#a6e22e>Addr</span>:    <span style=color:#e6db74>&#34;:8080&#34;</span>,
		<span style=color:#a6e22e>Handler</span>: <span style=color:#a6e22e>handler</span>,
	}
	<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Fatal</span>(<span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>ListenAndServe</span>())
}
</code></pre></div></div><footer><ul class=stats><li class=categories><ul><i class="fa fa-folder"></i><li><a class=article-category-link href=/categories/golang>Golang</a></li></ul></li><li class=tags><ul><i class="fa fa-tags"></i><li><a class=article-category-link href=/tags/golang>Golang</a></li><li><a class=article-category-link href=/tags/http>HTTP</a></li></ul></li></ul></footer></article><article class=post><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"blog-khfo0axv59"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></article><ul class="actions pagination"><li><a href=/blog/finderrornumber/ class="button big previous">FindErrorNumber</a></li><li><a href=/blog/golangquicksort/ class="button big next">GolangQuickSort</a></li></ul></div><section id=sidebar><section id=intro><header><h2>LAMBDA</h2><p>I AM LAMBDA</p></header><ul class=icons><li><a href=/index.xml type=application/rss+xml target=_blank title=RSS class="fa fa-rss"></a></li><li><a href=//github.com/lambdaTW target=_blank title=GitHub class="fa fa-github"></a></li><li><a href=//gitlab.com/lambdaTW target=_blank title=GitLab class="fa fa-gitlab"></a></li><li><a href=mailto:lambda@lambda.tw title=Email class="fa fa-envelope"></a></li></ul></section><section class=recent-posts><div class=mini-posts><header><h3>Recent Posts</h3></header><div class=posts-container><article class=mini-post><header><h3><a href=/blog/python-project-5/>Python Project (5) Make Automatically</a></h3><time class=published datetime=2021-04-27>April 27, 2021</time></header></article><article class=mini-post><header><h3><a href=/blog/python-project-4/>Python Project (4) Test More</a></h3><time class=published datetime=2021-04-25>April 25, 2021</time></header></article><article class=mini-post><header><h3><a href=/blog/python-project-3/>Python Project (3) Test Your Project</a></h3><time class=published datetime=2021-04-24>April 24, 2021</time></header></article><article class=mini-post><header><h3><a href=/blog/python-project-2/>Python Project (2) Lint Your Project</a></h3><time class=published datetime=2021-04-23>April 23, 2021</time></header></article><article class=mini-post><header><h3><a href=/blog/python-project-1/>Python Project (1) setup.py setup.cfg</a></h3><time class=published datetime=2021-04-22>April 22, 2021</time></header></article></div><a href=/blog/ class=button>View more posts</a></div></section><section id=categories><header><h3><a href=/categories/>Categories</a></h3></header><p><article><header><a href=/categories/python/>python</a>
<span style=float:right>6</span></header></article></p><p><article><header><a href=/categories/golang/>golang</a>
<span style=float:right>5</span></header></article></p><p><article><header><a href=/categories/project/>project</a>
<span style=float:right>5</span></header></article></p><p><article><header><a href=/categories/django/>django</a>
<span style=float:right>2</span></header></article></p><p><article><header><a href=/categories/test/>test</a>
<span style=float:right>2</span></header></article></p><p><article><header><a href=/categories/grpc/>grpc</a>
<span style=float:right>1</span></header></article></p><p><article><header><a href=/categories/middleware/>middleware</a>
<span style=float:right>1</span></header></article></p></section><section id=mini-bio><h3>About</h3><p>This blog show everything</p><a href=/about/ class=button>Learn More</a></section><section id=footer><ul class=icons><li><a href=/index.xml type=application/rss+xml target=_blank title=RSS class="fa fa-rss"></a></li><li><a href=//github.com/lambdaTW target=_blank title=GitHub class="fa fa-github"></a></li><li><a href=//gitlab.com/lambdaTW target=_blank title=GitLab class="fa fa-gitlab"></a></li><li><a href=mailto:lambda@lambda.tw title=Email class="fa fa-envelope"></a></li></ul><p class=copyright>&copy; 2021
Lambda
.
Powered by <a href=//gohugo.io target=_blank>Hugo</a></p></section></section></div><a id=back-to-top href=# class="fa fa-arrow-up fa-border fa-2x"></a><script src=//cdn.bootcss.com/highlight.js/9.11.0/highlight.min.js></script><script src=//cdn.bootcss.com/highlight.js/9.11.0/languages/r.min.js></script><script src=//cdn.bootcss.com/highlight.js/9.11.0/languages/yaml.min.js></script><script src=//cdn.bootcss.com/highlight.js/9.11.0/languages/css.min.js></script><script>hljs.configure({languages:[]});hljs.initHighlightingOnLoad();</script><script src=https://code.jquery.com/jquery-3.2.1.min.js integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/skel/3.0.1/skel.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.1.25/jquery.fancybox.min.js></script><script src=/js/util.js></script><script src=/js/main.js></script><script src=/js/backToTop.js></script><script>hljs.initHighlightingOnLoad();</script><script src=//yihui.name/js/math-code.js></script><script async src="//cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script></body></html>